#include <sycl/ext/intel/fpga_extensions.hpp>
#include <sycl/sycl.hpp>
#include <vector>

#include "exception_handler.hpp"
#include "svd.hpp"
#include "svd_testcase.hpp"

// clang-format off
SVDTestcase<float, 4, 4> small_4x4(
    std::vector<std::vector<float>>{
        {0.47084338, 0.99594452, 0.47982739, 0.69202168},
        {0.45148837, 0.72836647, 0.64691844, 0.62442883},
        {0.80974833, 0.82555856, 0.30709051, 0.58230306},
        {0.97898197, 0.98520343, 0.40133633, 0.85319924}},
    std::vector<float>({2.79495619, 0.44521050, 0.19458290, 0.07948970}));

SVDTestcase<float, 16, 8> testcase_16x8(
    std::vector<std::vector<float>>{
        {0.09197247, 0.14481869, 0.10407299, 0.25374938, 0.47811572, 0.63954233, 0.04104508, 0.38657333},
        {0.92316611, 0.76245709, 0.61539652, 0.89160593, 0.77919693, 0.14006746, 0.64050778, 0.88513825},
        {0.88713833, 0.21569021, 0.52698917, 0.25837260, 0.62761090, 0.16705069, 0.55006137, 0.15100562},
        {0.17933577, 0.44237509, 0.29164377, 0.04858151, 0.14284620, 0.97584930, 0.95781132, 0.97861833},
        {0.22954940, 0.53285279, 0.82211794, 0.24442794, 0.72065117, 0.82616029, 0.82302578, 0.31588218},
        {0.52760637, 0.83106858, 0.68334733, 0.58536486, 0.10177759, 0.83382267, 0.48252385, 0.33405913},
        {0.64459388, 0.44615274, 0.13607273, 0.84666874, 0.70038514, 0.05981429, 0.68471502, 0.02031992},
        {0.19211154, 0.97691734, 0.21380459, 0.18721380, 0.33669170, 0.05466270, 0.56268200, 0.05253976},
        {0.89958544, 0.17120118, 0.99595207, 0.38795272, 0.13999617, 0.22699871, 0.28511385, 0.29012966},
        {0.70594215, 0.04854467, 0.21545484, 0.15641926, 0.43467411, 0.92386666, 0.96494161, 0.19284229},
        {0.81370076, 0.90629365, 0.56153730, 0.26047083, 0.66264490, 0.83971270, 0.61051658, 0.68128875},
        {0.76390120, 0.74742154, 0.83273900, 0.83469578, 0.21863598, 0.52614912, 0.29617421, 0.87313192},
        {0.71767589, 0.42840114, 0.70372481, 0.82935507, 0.34454722, 0.92729788, 0.30406199, 0.92858277},
        {0.99486099, 0.60156528, 0.30723120, 0.68557917, 0.29556701, 0.23800143, 0.03078199, 0.19057876},
        {0.74059190, 0.68368920, 0.60495242, 0.66351287, 0.02082209, 0.90596643, 0.79826228, 0.13455221},
        {0.99834564, 0.98115456, 0.26081567, 0.80371092, 0.57020481, 0.80252733, 0.42442830, 0.54069138}},
    std::vector<float>({6.07216041, 1.71478328, 1.33994999, 1.14303961,
                        1.03316111, 0.94044096, 0.70064505, 0.65932612}));

SVDTestcase<float, 16, 16> testcase_16x16(
    std::vector<std::vector<float>>{
        {0.68276283, 0.49255718, 0.63929751, 0.57384096, 0.01703033, 0.62920057, 0.41547286, 0.43125397, 0.97783246, 0.80992296, 0.57865027, 0.79901438, 0.37191359, 0.67199688, 0.51030070, 0.27930948},
        {0.99373105, 0.94528344, 0.95215205, 0.09747271, 0.75358214, 0.92325987, 0.75572023, 0.37840999, 0.32925426, 0.97096151, 0.27322831, 0.23517233, 0.87816186, 0.36029095, 0.25462154, 0.37673972},
        {0.44332160, 0.91581926, 0.21864584, 0.18590251, 0.78603471, 0.80808792, 0.20510208, 0.57256409, 0.28157167, 0.50274521, 0.07927001, 0.89426865, 0.86481090, 0.23421359, 0.91832031, 0.00895887},
        {0.35128019, 0.93155152, 0.14143556, 0.62957437, 0.64311356, 0.37817771, 0.40472551, 0.37105396, 0.95650134, 0.27878449, 0.30705480, 0.32448103, 0.51242633, 0.43232644, 0.85543396, 0.63720522},
        {0.53517469, 0.63960027, 0.79964193, 0.09086837, 0.45488997, 0.24300159, 0.65375105, 0.88954465, 0.41606669, 0.87517555, 0.93100717, 0.24876579, 0.73477118, 0.30520039, 0.24700350, 0.69827850},
        {0.68205052, 0.94945852, 0.11570721, 0.83817320, 0.20631211, 0.32649062, 0.92603918, 0.15895109, 0.30501049, 0.58395329, 0.91398453, 0.17737326, 0.10678880, 0.84970322, 0.69413706, 0.00669290},
        {0.04708758, 0.66642335, 0.51931467, 0.56641007, 0.69398532, 0.63362721, 0.34583455, 0.62278845, 0.40243883, 0.22682512, 0.99816962, 0.24558134, 0.32807392, 0.61966618, 0.84085010, 0.71532334},
        {0.12425643, 0.13070194, 0.58565749, 0.38312386, 0.91508168, 0.67751297, 0.59180278, 0.15937596, 0.79940277, 0.58221317, 0.00047954, 0.11945869, 0.60335118, 0.24873020, 0.10047740, 0.82272227},
        {0.23958378, 0.30786875, 0.20108669, 0.38881828, 0.28524684, 0.42603587, 0.59211639, 0.64429699, 0.06819582, 0.85699403, 0.28052013, 0.56564663, 0.23546312, 0.37824603, 0.01700420, 0.83842408},
        {0.61330398, 0.17267777, 0.38673569, 0.85026123, 0.64619668, 0.25609217, 0.58215545, 0.07791763, 0.82323095, 0.35861841, 0.75252394, 0.43633555, 0.50152098, 0.90704907, 0.28045778, 0.38839985},
        {0.09223787, 0.26193450, 0.73328962, 0.42455572, 0.55586540, 0.86487900, 0.43845990, 0.24678735, 0.40259416, 0.14172626, 0.99459246, 0.15511372, 0.20375592, 0.61043033, 0.75669082, 0.00490737},
        {0.63979215, 0.41259531, 0.02388034, 0.87860844, 0.44965340, 0.93987008, 0.70930821, 0.27369748, 0.98482142, 0.57745382, 0.42990581, 0.49365026, 0.24703571, 0.61202423, 0.52194954, 0.89125794},
        {0.14755335, 0.04278190, 0.83886669, 0.07896022, 0.67396401, 0.85489978, 0.95300479, 0.13694853, 0.74248431, 0.10584044, 0.21545136, 0.29919672, 0.73014468, 0.24061253, 0.30350301, 0.37591049},
        {0.72556777, 0.36217037, 0.25800495, 0.43840681, 0.85544885, 0.39071761, 0.99577062, 0.71071566, 0.78768216, 0.89981829, 0.81288010, 0.73119443, 0.67048738, 0.48856485, 0.12707463, 0.02609364},
        {0.04580879, 0.11421446, 0.03333039, 0.82099143, 0.04106124, 0.41544612, 0.13662192, 0.54964656, 0.08109745, 0.71175559, 0.41514879, 0.11674855, 0.14185785, 0.17569813, 0.15010763, 0.83859777},
        {0.22511684, 0.76951675, 0.23042551, 0.94511609, 0.50850416, 0.58506621, 0.03104895, 0.17632658, 0.16422679, 0.34154028, 0.53349813, 0.36140192, 0.36163860, 0.58032605, 0.04891582, 0.47224104}},
    std::vector<float>({7.90036099, 2.00844529, 1.73369523, 1.66056506, 1.52671224, 1.42307602, 1.05933772, 0.96801277, 0.92641064, 0.81959008, 0.48112682, 0.38591756, 0.36828443, 0.33476335, 0.08362597, 0.00200672}));

SVDTestcase<float, 32, 32> testcase_32x32(
    std::vector<std::vector<float>>{
        {0.09160261, 0.91022315, 0.24510887, 0.29957217, 0.70942188, 0.63601434, 0.59449134, 0.86897618, 0.06452419, 0.15623671, 0.34107247, 0.08428666, 0.90401406, 0.36864823, 0.33862045, 0.09431988, 0.41343586, 0.24491570, 0.24707064, 0.48779864, 0.08266120, 0.34643317, 0.78746108, 0.21402334, 0.24389833, 0.26959300, 0.64420741, 0.87237336, 0.15605053, 0.59605679, 0.82352827, 0.70134547},
        {0.61781635, 0.06861090, 0.53042843, 0.00456279, 0.67639882, 0.97668708, 0.65147163, 0.65402961, 0.91687924, 0.37859681, 0.35006902, 0.05139260, 0.95246514, 0.51061325, 0.78820863, 0.67882417, 0.17555928, 0.68811495, 0.39943400, 0.92584883, 0.81390515, 0.08508194, 0.91215963, 0.16712883, 0.50178891, 0.84903664, 0.88545009, 0.85707511, 0.95245131, 0.59050788, 0.26868967, 0.61688217},
        {0.84191990, 0.58006674, 0.47402737, 0.26748864, 0.94478048, 0.15238714, 0.60835433, 0.03965139, 0.77350550, 0.11342492, 0.74362738, 0.14581430, 0.94519102, 0.49828902, 0.50525563, 0.99740150, 0.70888986, 0.58920506, 0.89977455, 0.51750875, 0.67179678, 0.87694234, 0.58589104, 0.29306538, 0.83917103, 0.38719664, 0.42447727, 0.74006014, 0.91615832, 0.71579256, 0.02420173, 0.44761767},
        {0.83455029, 0.02348106, 0.57653224, 0.51516326, 0.16544165, 0.49455145, 0.58633336, 0.27506492, 0.54542619, 0.23849794, 0.44576002, 0.41962566, 0.35351790, 0.70471554, 0.62466546, 0.11828546, 0.10711968, 0.57012915, 0.01036188, 0.16829202, 0.28723155, 0.87448205, 0.10704053, 0.93912681, 0.82836970, 0.11692724, 0.77006265, 0.90543877, 0.42014430, 0.39981074, 0.12251676, 0.67799884},
        {0.51501773, 0.35187301, 0.54362708, 0.02779194, 0.23321762, 0.44994875, 0.06265559, 0.82806301, 0.95760870, 0.96727985, 0.25819922, 0.29198140, 0.95312470, 0.61061063, 0.88223843, 0.21922940, 0.46928347, 0.53978359, 0.00021489, 0.43641425, 0.85843643, 0.19396291, 0.86550715, 0.58965877, 0.02869712, 0.25524624, 0.99842443, 0.89633140, 0.75322723, 0.66866724, 0.80101728, 0.74784064},
        {0.63103797, 0.15928580, 0.29422897, 0.59174883, 0.31921161, 0.24560192, 0.79035824, 0.04080311, 0.88572573, 0.73140504, 0.41859492, 0.18780896, 0.13196521, 0.58803751, 0.10720208, 0.45251951, 0.10077345, 0.72306068, 0.69207405, 0.05897522, 0.31349247, 0.67812150, 0.07990463, 0.07402813, 0.87662344, 0.46741651, 0.55990962, 0.87807249, 0.42622130, 0.81712067, 0.66038715, 0.26745718},
        {0.36922983, 0.86058195, 0.21145755, 0.44455238, 0.07653453, 0.16387220, 0.61407073, 0.49835456, 0.80169642, 0.06828906, 0.11637570, 0.29463421, 0.26261800, 0.33549407, 0.35631125, 0.24295079, 0.49775532, 0.11259018, 0.03614247, 0.60093510, 0.20769689, 0.14833736, 0.53678996, 0.16180519, 0.33149942, 0.66870722, 0.93772138, 0.09620824, 0.12676891, 0.01937064, 0.67533574, 0.79146456},
        {0.52801862, 0.72802678, 0.69454634, 0.33274596, 0.94539933, 0.78358600, 0.22398099, 0.79626979, 0.76379059, 0.98243783, 0.16574556, 0.34110124, 0.21146674, 0.49062169, 0.89139888, 0.86481171, 0.65068052, 0.19871838, 0.25939364, 0.39279366, 0.77840006, 0.93400110, 0.50880977, 0.58842008, 0.84380156, 0.55034509, 0.56294671, 0.00944802, 0.66891809, 0.67963271, 0.55299730, 0.93767773},
        {0.10785668, 0.89653517, 0.42898212, 0.75566827, 0.62261907, 0.58494829, 0.49696524, 0.25650305, 0.71780886, 0.33583642, 0.81701973, 0.76079358, 0.62352342, 0.38646748, 0.65731457, 0.52010587, 0.84544406, 0.27765204, 0.41547534, 0.56709138, 0.09345703, 0.60466481, 0.80335679, 0.94607050, 0.36364429, 0.25991345, 0.68793291, 0.41092531, 0.45056004, 0.27524555, 0.35992870, 0.28347942},
        {0.68294993, 0.21796411, 0.52052867, 0.61836116, 0.10624480, 0.68925062, 0.95109785, 0.34685728, 0.11632817, 0.56980058, 0.46716645, 0.80512782, 0.25565352, 0.78970326, 0.80259865, 0.00384669, 0.58879944, 0.49322886, 0.44667115, 0.17367906, 0.08646102, 0.11710092, 0.73991519, 0.89840049, 0.18654957, 0.07231262, 0.05470094, 0.24036179, 0.46470386, 0.12969900, 0.16907458, 0.35656250},
        {0.60066836, 0.71889950, 0.91591070, 0.96534743, 0.47796198, 0.25724791, 0.65354746, 0.63569414, 0.58625798, 0.78999574, 0.45234198, 0.79450249, 0.29383649, 0.95639802, 0.62605690, 0.32588573, 0.70322462, 0.54902631, 0.31298042, 0.30912468, 0.20877528, 0.19908497, 0.91055996, 0.82419434, 0.84762293, 0.12921528, 0.17837571, 0.51285953, 0.62035555, 0.98427848, 0.09899292, 0.37559862},
        {0.28192452, 0.69949702, 0.00848447, 0.86969251, 0.09874982, 0.47958201, 0.55224542, 0.65524231, 0.00636676, 0.22163902, 0.45358741, 0.56471771, 0.12007421, 0.67842475, 0.72941061, 0.41144171, 0.15352222, 0.42906936, 0.66177129, 0.85630391, 0.50018039, 0.83202271, 0.01850908, 0.57542235, 0.43682133, 0.70095653, 0.27485212, 0.62229201, 0.64498544, 0.45615591, 0.66904278, 0.28223270},
        {0.37857284, 0.51068299, 0.27734371, 0.86014687, 0.96363135, 0.15911817, 0.53041897, 0.15319089, 0.50657736, 0.28713557, 0.18268614, 0.04311521, 0.69528925, 0.35590389, 0.07641772, 0.62594561, 0.38149628, 0.34374823, 0.29130715, 0.64509894, 0.47947929, 0.59786874, 0.96051319, 0.21371017, 0.86626798, 0.42420973, 0.98717334, 0.20421398, 0.43718922, 0.23045575, 0.33028668, 0.65916098},
        {0.73613154, 0.91619382, 0.56340099, 0.93305650, 0.35954739, 0.15187203, 0.06933153, 0.79022570, 0.17300313, 0.31643577, 0.12051592, 0.82686570, 0.63118874, 0.26253803, 0.10633473, 0.20711615, 0.02858970, 0.62522547, 0.58214724, 0.67580516, 0.83986052, 0.61297257, 0.90065146, 0.47510831, 0.46107899, 0.81383926, 0.65081390, 0.73792142, 0.26320879, 0.61928638, 0.64144534, 0.96059371},
        {0.44387744, 0.62492624, 0.05399423, 0.84994257, 0.00254610, 0.13482697, 0.49639508, 0.08296875, 0.70277847, 0.59914538, 0.01177960, 0.78589307, 0.46048657, 0.97628639, 0.76494945, 0.77751272, 0.53772408, 0.11486632, 0.87893309, 0.29708948, 0.87888418, 0.19324126, 0.43455407, 0.81497133, 0.59837143, 0.83525139, 0.72482859, 0.68180069, 0.80472700, 0.56173614, 0.09046329, 0.32730460},
        {0.95961606, 0.28280811, 0.75397509, 0.48669521, 0.74023605, 0.64884377, 0.43287113, 0.16064339, 0.91497093, 0.97070078, 0.59251224, 0.11398226, 0.61936022, 0.94876608, 0.72958491, 0.41777106, 0.36528953, 0.21140649, 0.75692939, 0.28551106, 0.90719423, 0.92946522, 0.18064998, 0.26098873, 0.64012606, 0.88195923, 0.66279899, 0.00349931, 0.03723752, 0.64374276, 0.55805427, 0.99592974},
        {0.97125596, 0.71709282, 0.40133509, 0.06843159, 0.33057056, 0.84757473, 0.64274611, 0.31497144, 0.20434266, 0.15640755, 0.30731533, 0.24100701, 0.87113108, 0.83768897, 0.31039795, 0.58760556, 0.52137385, 0.98155401, 0.88172028, 0.43851844, 0.34769756, 0.95621987, 0.61505681, 0.12688484, 0.38822916, 0.68495658, 0.79397578, 0.68340707, 0.90041584, 0.08531077, 0.63165203, 0.03536885},
        {0.83836260, 0.48123682, 0.31637068, 0.44708389, 0.64954641, 0.57134970, 0.36207479, 0.20072914, 0.56113689, 0.97026253, 0.67207458, 0.45412577, 0.95731202, 0.88614298, 0.45108865, 0.44348886, 0.04296515, 0.70277168, 0.12591584, 0.10446874, 0.45698820, 0.82594866, 0.50462136, 0.58322845, 0.29853894, 0.34106484, 0.54381983, 0.41161978, 0.35346748, 0.35636276, 0.29918584, 0.53410071},
        {0.09102750, 0.21303252, 0.19443323, 0.61958608, 0.78238081, 0.78008708, 0.14408277, 0.45573637, 0.28638759, 0.57446376, 0.31988127, 0.21095571, 0.21871908, 0.54727201, 0.87350414, 0.92771704, 0.96536156, 0.18703933, 0.40332880, 0.80936440, 0.16915078, 0.94808380, 0.51550447, 0.21137788, 0.76211091, 0.45903780, 0.26430273, 0.70352407, 0.73829981, 0.96873387, 0.61073088, 0.80087422},
        {0.07515263, 0.61780497, 0.96680437, 0.96941976, 0.07483267, 0.07868417, 0.84908704, 0.35164531, 0.97647506, 0.46864331, 0.78013413, 0.99384438, 0.85350343, 0.74166378, 0.89835968, 0.07462669, 0.84354412, 0.40639130, 0.62613884, 0.22511091, 0.16281294, 0.15700520, 0.97264392, 0.29693966, 0.62480702, 0.69513973, 0.08955417, 0.77107624, 0.86301334, 0.27404487, 0.28588642, 0.20278772},
        {0.28858598, 0.04828633, 0.04655704, 0.65393919, 0.54639041, 0.51826507, 0.24850125, 0.72603710, 0.49503506, 0.07222788, 0.92887232, 0.62978928, 0.61950599, 0.50092484, 0.24503577, 0.73980188, 0.18791635, 0.29860562, 0.33495447, 0.11810158, 0.41819829, 0.38533700, 0.81094232, 0.16308025, 0.28720912, 0.27812144, 0.18119005, 0.65906969, 0.15915866, 0.65213579, 0.38888756, 0.03260391},
        {0.36110706, 0.44906659, 0.82144871, 0.57426798, 0.95018709, 0.13953429, 0.22548319, 0.81652326, 0.17342792, 0.71441978, 0.37211871, 0.57085751, 0.71338482, 0.03936276, 0.98745407, 0.83421838, 0.84735311, 0.47392589, 0.31498118, 0.14423168, 0.32798527, 0.77332195, 0.49101374, 0.21305647, 0.09683846, 0.44545230, 0.57154258, 0.26040835, 0.07567924, 0.87993901, 0.58696524, 0.40843499},
        {0.70495289, 0.55676633, 0.70455592, 0.08628807, 0.22740472, 0.52477744, 0.43545016, 0.77180462, 0.64150489, 0.07727155, 0.62052123, 0.24758297, 0.14592516, 0.53879188, 0.98965831, 0.96071580, 0.57779265, 0.85471517, 0.10022669, 0.33999915, 0.10340450, 0.86684345, 0.10757494, 0.61628268, 0.27693368, 0.45157881, 0.99713853, 0.46400424, 0.08427699, 0.31389944, 0.99100521, 0.17087964},
        {0.82688646, 0.00253818, 0.89748614, 0.65046532, 0.24939125, 0.24889424, 0.94385939, 0.85822911, 0.46628891, 0.84340582, 0.16695208, 0.39558844, 0.96629725, 0.98360390, 0.35414194, 0.03071455, 0.69941826, 0.79026693, 0.35922077, 0.26818753, 0.49041051, 0.66910461, 0.73540803, 0.75753304, 0.13172365, 0.29984439, 0.69806946, 0.06026203, 0.50884984, 0.22734692, 0.37847724, 0.79917395},
        {0.56262435, 0.64857002, 0.70124506, 0.03700441, 0.67396744, 0.25379145, 0.69940491, 0.25260360, 0.51771858, 0.27092409, 0.59861201, 0.54768424, 0.37185224, 0.37701012, 0.51882546, 0.20572698, 0.55436119, 0.02134398, 0.95021990, 0.83150714, 0.59148864, 0.99401318, 0.65557849, 0.87993047, 0.50396590, 0.57960798, 0.09564320, 0.99383197, 0.40463088, 0.45565236, 0.54238324, 0.29422867},
        {0.63919107, 0.08819671, 0.34694109, 0.14349443, 0.05777960, 0.91869831, 0.14144267, 0.65702998, 0.44952274, 0.81795339, 0.28350074, 0.77369859, 0.09579994, 0.67442623, 0.16912164, 0.35305560, 0.95026890, 0.65039757, 0.40361211, 0.61118117, 0.89487892, 0.15465875, 0.99832923, 0.02985335, 0.64388041, 0.47525486, 0.83957602, 0.54968182, 0.97661656, 0.95713116, 0.50589438, 0.60106109},
        {0.57307976, 0.64974435, 0.54997552, 0.04320363, 0.81983854, 0.54846628, 0.09552791, 0.78860963, 0.15731682, 0.75276702, 0.44827035, 0.33965773, 0.51720610, 0.12840033, 0.42879568, 0.86591619, 0.12279840, 0.95273611, 0.06326851, 0.56588181, 0.22854410, 0.39695722, 0.71494919, 0.93755317, 0.29345569, 0.96807085, 0.48998123, 0.91836206, 0.54194135, 0.44886578, 0.82116979, 0.93126678},
        {0.03405660, 0.34112982, 0.92162006, 0.73277109, 0.80204874, 0.24322055, 0.50042450, 0.83748242, 0.11897857, 0.36895820, 0.82378133, 0.42259716, 0.32625206, 0.66270054, 0.20029253, 0.68140897, 0.85937448, 0.41192381, 0.34544658, 0.88558784, 0.91769673, 0.66056652, 0.41590863, 0.32170105, 0.16445228, 0.81878387, 0.10148878, 0.25299352, 0.75028528, 0.58518752, 0.20067543, 0.21140365},
        {0.52666338, 0.02945282, 0.04089074, 0.94133439, 0.94650552, 0.49017981, 0.06182479, 0.42091869, 0.60143318, 0.28865031, 0.87086255, 0.33397986, 0.72630520, 0.37609789, 0.27850319, 0.47793963, 0.74623492, 0.32653511, 0.01438800, 0.32008536, 0.16025304, 0.80539925, 0.73335880, 0.06840029, 0.79907093, 0.20710748, 0.94860058, 0.31534001, 0.79077609, 0.52135388, 0.45576550, 0.81098150},
        {0.21324382, 0.99932993, 0.84994959, 0.59426335, 0.83326853, 0.28440134, 0.22738960, 0.89616261, 0.12884894, 0.56816588, 0.41602355, 0.48699075, 0.63323604, 0.97306864, 0.64196968, 0.64707513, 0.70166466, 0.17496601, 0.76433897, 0.27186067, 0.46175917, 0.83638816, 0.95305561, 0.21858168, 0.65646386, 0.83833894, 0.41688457, 0.25843945, 0.11748912, 0.13921747, 0.36433417, 0.11656121},
        {0.41696284, 0.06417218, 0.67342929, 0.08746446, 0.58041921, 0.79494341, 0.11330435, 0.35916229, 0.38767118, 0.46440201, 0.67878304, 0.32021899, 0.82052469, 0.52385799, 0.82966053, 0.51388515, 0.99410985, 0.30753948, 0.19669159, 0.71566447, 0.17434940, 0.89206902, 0.88554484, 0.47477661, 0.63177959, 0.17996627, 0.56146468, 0.78580343, 0.93836343, 0.41967329, 0.18307030, 0.89183832},
        {0.00878404, 0.15628947, 0.19683648, 0.73906558, 0.46011778, 0.39758366, 0.86413869, 0.88964370, 0.56482681, 0.40794713, 0.55183873, 0.24368907, 0.87169371, 0.69017968, 0.41907717, 0.88018047, 0.95215379, 0.92305233, 0.58886409, 0.54541284, 0.86469702, 0.34757331, 0.53787349, 0.58652228, 0.62032226, 0.15607276, 0.18437886, 0.28372080, 0.97251812, 0.25101190, 0.78696405, 0.94938728}},
    std::vector<float>({16.30218405, 3.04363280, 2.76785642, 2.59801002, 2.52816392, 2.41425312, 2.28552194, 2.20995608, 2.02551555, 1.92531293, 1.89721910, 1.75630161, 1.62583134, 1.47765474, 1.40730773, 1.34409865, 1.27185033, 1.14460264, 1.10047034, 0.99918445, 0.92880682, 0.81277967, 0.69906073, 0.57063507, 0.54806977, 0.46506634, 0.39994964, 0.31467254, 0.19620821, 0.15874032, 0.09107956, 0.03180609}));
// clang-format on

int main(int argc, char *argv[]) {
#if FPGA_HARDWARE
  int repetitions = 16384;
#else
  int repetitions = 1;
#endif
  if (argc == 2) {
    repetitions = std::stoi(argv[1]);
  }

  try {
#if FPGA_SIMULATOR
    auto selector = sycl::ext::intel::fpga_simulator_selector_v;
#elif FPGA_HARDWARE
    auto selector = sycl::ext::intel::fpga_selector_v;
#else
    auto selector = sycl::ext::intel::fpga_emulator_selector_v;
#endif

    // Enable the queue profiling to time the execution
    sycl::property_list queue_properties{
        sycl::property::queue::enable_profiling()};
    sycl::queue q =
        sycl::queue(selector, fpga_tools::exception_handler, queue_properties);
    std::cout << "Running on device: "
              << q.get_device().get_info<sycl::info::device::name>() << "\n";

#if FPGA_SIMULATOR
    auto test_error = small_4x4.RunTest(q, repetitions);
    small_4x4.PrintResult();
#else
    auto test_error = testcase_32x32.RunTest(q, repetitions);
    testcase_32x32.PrintResult();
#endif
    bool passed = test_error < 0.1;
    std::cout << (passed ? "PASSED" : "FAILED") << std::endl;
    return passed ? EXIT_SUCCESS : EXIT_FAILURE;

  } catch (sycl::exception const &e) {
    std::cerr << "Caught a synchronous SYCL exception: " << e.what()
              << std::endl;
    std::terminate();
  }
}